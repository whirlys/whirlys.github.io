<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MySQL Binlog 解析工具 Maxwell 详解 | 小旋锋</title>
  <meta name="keywords" content=" mysql ">
  <meta name="description" content="MySQL Binlog 解析工具 Maxwell 详解 | 小旋锋">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="maxwell 简介Maxwell是一个能实时读取MySQL二进制日志binlog，并生成 JSON 格式的消息，作为生产者发送给 Kafka，Kinesis、RabbitMQ、Redis、Google Cloud Pub/Sub、文件或其它平台的应用程序。它的常见应用场景有ETL、维护缓存、收集表级别的dml指标、增量到搜索引擎、数据分区迁移、切库binlog回滚方案等。官网(http://ma">
<meta name="keywords" content="mysql,maxwell">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL Binlog 解析工具 Maxwell 详解">
<meta property="og:url" content="http://laijianfeng.org/2019/03/MySQL-Binlog-解析工具-Maxwell-详解/index.html">
<meta property="og:site_name" content="小旋锋">
<meta property="og:description" content="maxwell 简介Maxwell是一个能实时读取MySQL二进制日志binlog，并生成 JSON 格式的消息，作为生产者发送给 Kafka，Kinesis、RabbitMQ、Redis、Google Cloud Pub/Sub、文件或其它平台的应用程序。它的常见应用场景有ETL、维护缓存、收集表级别的dml指标、增量到搜索引擎、数据分区迁移、切库binlog回滚方案等。官网(http://ma">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://image.laijianfeng.org/20190310_163023.png">
<meta property="og:image" content="http://image.laijianfeng.org/20190310_234508.png">
<meta property="og:image" content="http://image.laijianfeng.org/20190116_014816.png">
<meta property="og:updated_time" content="2019-03-12T04:52:09.792Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL Binlog 解析工具 Maxwell 详解">
<meta name="twitter:description" content="maxwell 简介Maxwell是一个能实时读取MySQL二进制日志binlog，并生成 JSON 格式的消息，作为生产者发送给 Kafka，Kinesis、RabbitMQ、Redis、Google Cloud Pub/Sub、文件或其它平台的应用程序。它的常见应用场景有ETL、维护缓存、收集表级别的dml指标、增量到搜索引擎、数据分区迁移、切库binlog回滚方案等。官网(http://ma">
<meta name="twitter:image" content="http://image.laijianfeng.org/20190310_163023.png">


<link rel="icon" href="/img/favicon.jpg">

<link rel="stylesheet" href="/css/style.css">

<link rel="stylesheet" href="/css/hl_theme/darcula.css">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<link href="//cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="true">
</div>
<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>小旋锋</span>
</div>

<div class="icon">
    
    <a class="rss" title="rss" href="/atom.xml" target="_blank"></a>
    
    
    <a class="github" title="github" href="https://github.com/whirlys" target="_blank"></a>
    
    
    
    
    
    
    
    
    <a class="email" title="email" href="mailto:whirlys@163.com"></a>
    
</div>



<ul>
    <li class="all active">全部文章</li>
    
    <li data-rel="后端"> 后端 </li>
    
    <li data-rel="生活杂记"> 生活杂记 </li>
    
    <li data-rel="大数据"> 大数据 </li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    </div>
    <div><a  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="44">
<input type="hidden" id="yelog_site_word_count" value="143.0k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>
    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
            <li><a target="_blank" href="https://godbmw.com/">GODBMW</a></li>
            
            <li><a target="_blank" href="http://www.codesheep.cn/">CodeSheep 程序羊</a></li>
            
            <li><a target="_blank" href="http://www.hualong.me/">刘华龙的小窝</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="以 in: 开头进行全文搜索" autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
        <label for="tagswitch">Tags:</label>
        <input id="tagswitch" type="checkbox">
    </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Java编程</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">elasticsearch</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">lucene</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">java</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">spark</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">mysql</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Zookeeper</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">设计模式</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">博客</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">分布式系统理论</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a  class="后端 "
           href="/2019/03/MySQL-Binlog-解析工具-Maxwell-详解/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL Binlog 解析工具 Maxwell 详解">MySQL Binlog 解析工具 Maxwell 详解</span>
            <span class="post-date" title="2019-03-11 00:21:07">2019/03/11</span>
        </a>
        
        <a  class="后端 "
           href="/2019/03/MySQL-Binlog-介绍/"
           data-tag="mysql"
           data-author="" >
            <span class="post-title" title="MySQL Binlog 介绍">MySQL Binlog 介绍</span>
            <span class="post-date" title="2019-03-09 20:29:41">2019/03/09</span>
        </a>
        
        <a  class="大数据 "
           href="/2019/01/利用Zookeeper实现-分布式锁/"
           data-tag="Zookeeper"
           data-author="" >
            <span class="post-title" title="利用Zookeeper实现 - 分布式锁">利用Zookeeper实现 - 分布式锁</span>
            <span class="post-date" title="2019-01-28 11:03:44">2019/01/28</span>
        </a>
        
        <a  class="大数据 "
           href="/2019/01/利用Zookeeper实现-数据发布订阅/"
           data-tag="Zookeeper"
           data-author="" >
            <span class="post-title" title="利用Zookeeper实现 - 数据发布订阅">利用Zookeeper实现 - 数据发布订阅</span>
            <span class="post-date" title="2019-01-24 02:13:43">2019/01/24</span>
        </a>
        
        <a  class="大数据 "
           href="/2019/01/利用Zookeeper实现-Master选举/"
           data-tag="Zookeeper"
           data-author="" >
            <span class="post-title" title="利用Zookeeper实现 - Master选举">利用Zookeeper实现 - Master选举</span>
            <span class="post-date" title="2019-01-23 00:07:38">2019/01/23</span>
        </a>
        
        <a  class="大数据 "
           href="/2019/01/Zookeeper-分布式协调服务介绍/"
           data-tag="Zookeeper"
           data-author="" >
            <span class="post-title" title="Zookeeper 分布式协调服务介绍">Zookeeper 分布式协调服务介绍</span>
            <span class="post-date" title="2019-01-21 21:24:09">2019/01/21</span>
        </a>
        
        <a  class="大数据 "
           href="/2019/01/分布式系统-CAP-定理图解/"
           data-tag="分布式系统理论"
           data-author="" >
            <span class="post-title" title="分布式系统 | CAP 定理图解">分布式系统 | CAP 定理图解</span>
            <span class="post-date" title="2019-01-16 01:18:59">2019/01/16</span>
        </a>
        
        <a  class="后端 "
           href="/2019/01/设计模式-解释器模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 解释器模式及典型应用">设计模式 | 解释器模式及典型应用</span>
            <span class="post-date" title="2019-01-13 16:35:37">2019/01/13</span>
        </a>
        
        <a  class="后端 "
           href="/2019/01/ArrayList-源码分析/"
           data-tag="Java编程"
           data-author="" >
            <span class="post-title" title="ArrayList 源码分析">ArrayList 源码分析</span>
            <span class="post-date" title="2019-01-09 20:21:09">2019/01/09</span>
        </a>
        
        <a  class="大数据 "
           href="/2019/01/Elasticsearch源码分析-单节点的启动和关闭/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="Elasticsearch源码分析 | 单节点的启动和关闭">Elasticsearch源码分析 | 单节点的启动和关闭</span>
            <span class="post-date" title="2019-01-08 01:58:56">2019/01/08</span>
        </a>
        
        <a  class="后端 "
           href="/2019/01/设计模式-单例模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 单例模式及典型应用">设计模式 | 单例模式及典型应用</span>
            <span class="post-date" title="2019-01-07 01:35:54">2019/01/07</span>
        </a>
        
        <a  class="后端 "
           href="/2018/12/Java-动态代理详解/"
           data-tag="Java编程"
           data-author="" >
            <span class="post-title" title="Java 动态代理详解">Java 动态代理详解</span>
            <span class="post-date" title="2018-12-21 01:46:11">2018/12/21</span>
        </a>
        
        <a  class="后端 "
           href="/2018/12/Java反射机制详解/"
           data-tag="Java编程"
           data-author="" >
            <span class="post-title" title="Java反射机制详解">Java反射机制详解</span>
            <span class="post-date" title="2018-12-19 02:08:32">2018/12/19</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/12/Spark-SQL-分析-Imooc-访问日志/"
           data-tag="spark"
           data-author="" >
            <span class="post-title" title="Spark SQL 分析 Nginx 访问日志">Spark SQL 分析 Nginx 访问日志</span>
            <span class="post-date" title="2018-12-16 19:45:35">2018/12/16</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-责任链模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 责任链模式及典型应用">设计模式 | 责任链模式及典型应用</span>
            <span class="post-date" title="2018-10-31 15:16:12">2018/10/31</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-中介者模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 中介者模式及典型应用">设计模式 | 中介者模式及典型应用</span>
            <span class="post-date" title="2018-10-26 00:45:30">2018/10/26</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-备忘录模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 备忘录模式及典型应用">设计模式 | 备忘录模式及典型应用</span>
            <span class="post-date" title="2018-10-25 00:42:24">2018/10/25</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-观察者模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 观察者模式及典型应用">设计模式 | 观察者模式及典型应用</span>
            <span class="post-date" title="2018-10-24 00:30:56">2018/10/24</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-策略模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 策略模式及典型应用">设计模式 | 策略模式及典型应用</span>
            <span class="post-date" title="2018-10-18 20:33:43">2018/10/18</span>
        </a>
        
        <a  class="生活杂记 "
           href="/2018/10/20181013-燃烧吧，破铜烂铁！/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="20181013-燃烧吧，破铜烂铁！">20181013-燃烧吧，破铜烂铁！</span>
            <span class="post-date" title="2018-10-13 22:01:20">2018/10/13</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-迭代器模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 迭代器模式及典型应用">设计模式 | 迭代器模式及典型应用</span>
            <span class="post-date" title="2018-10-11 23:04:40">2018/10/11</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-模板方法模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 模板方法模式及典型应用">设计模式 | 模板方法模式及典型应用</span>
            <span class="post-date" title="2018-10-11 00:22:11">2018/10/11</span>
        </a>
        
        <a  class="后端 "
           href="/2018/10/设计模式-组合模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 组合模式及典型应用">设计模式 | 组合模式及典型应用</span>
            <span class="post-date" title="2018-10-05 17:18:04">2018/10/05</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-享元模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 享元模式及典型应用">设计模式 | 享元模式及典型应用</span>
            <span class="post-date" title="2018-09-25 01:15:00">2018/09/25</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-适配器模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 适配器模式及典型应用">设计模式 | 适配器模式及典型应用</span>
            <span class="post-date" title="2018-09-20 01:00:54">2018/09/20</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-装饰者模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 装饰者模式及典型应用">设计模式 | 装饰者模式及典型应用</span>
            <span class="post-date" title="2018-09-18 20:44:31">2018/09/18</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-外观模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 外观模式及典型应用">设计模式 | 外观模式及典型应用</span>
            <span class="post-date" title="2018-09-16 20:29:56">2018/09/16</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-原型模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 原型模式及典型应用">设计模式 | 原型模式及典型应用</span>
            <span class="post-date" title="2018-09-15 00:08:13">2018/09/15</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-建造者模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 建造者模式及典型应用">设计模式 | 建造者模式及典型应用</span>
            <span class="post-date" title="2018-09-12 00:39:42">2018/09/12</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式之抽象工厂模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 抽象工厂模式及典型应用">设计模式 | 抽象工厂模式及典型应用</span>
            <span class="post-date" title="2018-09-10 23:51:05">2018/09/10</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式之工厂方法模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 工厂方法模式及典型应用">设计模式 | 工厂方法模式及典型应用</span>
            <span class="post-date" title="2018-09-09 17:20:14">2018/09/09</span>
        </a>
        
        <a  class="后端 "
           href="/2018/09/设计模式-简单工厂模式及典型应用/"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="设计模式 | 简单工厂模式及典型应用">设计模式 | 简单工厂模式及典型应用</span>
            <span class="post-date" title="2018-09-07 23:13:45">2018/09/07</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/09/Elasticsearch-6-3-2-启动过程/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="Elasticsearch 6.3.2 启动过程">Elasticsearch 6.3.2 启动过程</span>
            <span class="post-date" title="2018-09-01 20:25:45">2018/09/01</span>
        </a>
        
        <a  class="后端 "
           href="/2018/08/Google-guava工具类的介绍和使用/"
           data-tag="java"
           data-author="" >
            <span class="post-title" title="Google guava工具类的介绍和使用">Google guava工具类的介绍和使用</span>
            <span class="post-date" title="2018-08-31 00:58:57">2018/08/31</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/Elasticsearch-中的-Guice/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="Elasticsearch 中的 Guice">Elasticsearch 中的 Guice</span>
            <span class="post-date" title="2018-08-31 00:39:17">2018/08/31</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/Elasticsearch-分布式特性/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="Elasticsearch 分布式特性">Elasticsearch 分布式特性</span>
            <span class="post-date" title="2018-08-25 18:29:15">2018/08/25</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/23个最有用的ES检索技巧-Java-API实现/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="23个最有用的ES检索技巧(Java API实现)">23个最有用的ES检索技巧(Java API实现)</span>
            <span class="post-date" title="2018-08-25 13:19:00">2018/08/25</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/教你编译调试Elasticsearch-6-3-2源码/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="教你编译调试Elasticsearch 6.3.2源码">教你编译调试Elasticsearch 6.3.2源码</span>
            <span class="post-date" title="2018-08-23 11:39:34">2018/08/23</span>
        </a>
        
        <a  class="生活杂记 "
           href="/2018/08/20180818音乐会/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="20180818音乐会">20180818音乐会</span>
            <span class="post-date" title="2018-08-18 22:44:24">2018/08/18</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/Lucene初体验/"
           data-tag="lucene"
           data-author="" >
            <span class="post-title" title="Lucene初体验">Lucene初体验</span>
            <span class="post-date" title="2018-08-18 16:23:02">2018/08/18</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/Elasticsearch-6-x-Mapping设置/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="Elasticsearch 6.x Mapping设置">Elasticsearch 6.x Mapping设置</span>
            <span class="post-date" title="2018-08-16 21:14:33">2018/08/16</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/倒排索引与分词/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="倒排索引与分词">倒排索引与分词</span>
            <span class="post-date" title="2018-08-15 23:50:57">2018/08/15</span>
        </a>
        
        <a  class="大数据 "
           href="/2018/08/ElasticSearch初体验/"
           data-tag="elasticsearch"
           data-author="" >
            <span class="post-title" title="ElasticSearch初体验">ElasticSearch初体验</span>
            <span class="post-date" title="2018-08-15 19:37:25">2018/08/15</span>
        </a>
        
        <a  class="后端 "
           href="/2018/05/使用hexo-github-pages搭建博客/"
           data-tag="博客"
           data-author="" >
            <span class="post-title" title="使用hexo+github pages搭建博客">使用hexo+github pages搭建博客</span>
            <span class="post-date" title="2018-05-23 11:35:46">2018/05/23</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-MySQL-Binlog-解析工具-Maxwell-详解" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">MySQL Binlog 解析工具 Maxwell 详解</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
            <a href="javascript:" data-rel="后端">后端</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color1">mysql</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2019-03-12 12:52:09'>2019-03-11 00:21</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:6,599</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#maxwell-简介"><span class="toc-text">maxwell 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#快速开始"><span class="toc-text">快速开始</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#输出JSON字符串的格式"><span class="toc-text">输出JSON字符串的格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进阶使用"><span class="toc-text">进阶使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本的配置"><span class="toc-text">基本的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-配置选项"><span class="toc-text">mysql 配置选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#生产者的配置"><span class="toc-text">生产者的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#过滤器配置"><span class="toc-text">过滤器配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据初始化"><span class="toc-text">数据初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Maxwell监控"><span class="toc-text">Maxwell监控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多个Maxwell实例"><span class="toc-text">多个Maxwell实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GTID-支持"><span class="toc-text">GTID 支持</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-text">注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#timestamp-column"><span class="toc-text">timestamp column</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#binary-column"><span class="toc-text">binary column</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#表结构不同步"><span class="toc-text">表结构不同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#大事务binlog"><span class="toc-text">大事务binlog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tableMapCache"><span class="toc-text">tableMapCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#提高消费性能"><span class="toc-text">提高消费性能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#binlog"><span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参考文档"><span class="toc-text">参考文档</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="maxwell-简介"><a href="#maxwell-简介" class="headerlink" title="maxwell 简介"></a>maxwell 简介</h3><p>Maxwell是一个能实时读取MySQL二进制日志binlog，并生成 JSON 格式的消息，作为生产者发送给 Kafka，Kinesis、RabbitMQ、Redis、Google Cloud Pub/Sub、文件或其它平台的应用程序。它的常见应用场景有ETL、维护缓存、收集表级别的dml指标、增量到搜索引擎、数据分区迁移、切库binlog回滚方案等。官网(<a href="http://maxwells-daemon.io)、GitHub(https://github.com/zendesk/maxwell)" target="_blank" rel="noopener">http://maxwells-daemon.io)、GitHub(https://github.com/zendesk/maxwell)</a></p>
<p>Maxwell主要提供了下列功能：</p>
<ul>
<li>支持 <code>SELECT * FROM table</code> 的方式进行全量数据初始化</li>
<li>支持在主库发生failover后，自动恢复binlog位置(GTID)</li>
<li>可以对数据进行分区，解决数据倾斜问题，发送到kafka的数据支持database、table、column等级别的数据分区</li>
<li>工作方式是伪装为Slave，接收binlog events，然后根据schemas信息拼装，可以接受ddl、xid、row等各种event</li>
</ul>
<p>除了Maxwell外，目前常用的MySQL Binlog解析工具主要有阿里的canal、mysql_streamer，三个工具对比如下：</p>
<p><img src="http://image.laijianfeng.org/20190310_163023.png" alt="canal、maxwell、mysql_streamer对比"></p>
<p>canal 由Java开发，分为服务端和客户端，拥有众多的衍生应用，性能稳定，功能强大；canal 需要自己编写客户端来消费canal解析到的数据。</p>
<p>maxwell相对于canal的优势是使用简单，它直接将数据变更输出为json字符串，不需要再编写客户端。</p>
<h4 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h4><p>首先MySQL需要先启用binlog，关于什么是MySQL binlog，可以参考文章《<a href="https://mp.weixin.qq.com/s?__biz=MzI1NDU0MTE1NA==&amp;mid=2247483875&amp;idx=1&amp;sn=2cdc232fa3036da52a826964996506a8&amp;chksm=e9c2edeedeb564f891b34ef1e47418bbe6b8cb6dcb7f48b5fa73b15cf1d63172df1a173c75d0&amp;scene=0&amp;xtrack=1&amp;key=e3977f8a79490c6345befb88d0bbf74cbdc6b508a52e61ea076c830a5b64c552def6c6ad848d4bcc7a1d21e53e30eb5c1ead33acdb97df779d0e6fa8a0fbe4bda32c04077ea0d3511bc9f9490ad0b46c&amp;ascene=1&amp;uin=MjI4MTc0ODEwOQ%3D%3D&amp;devicetype=Windows+7&amp;version=62060719&amp;lang=zh_CN&amp;pass_ticket=h8jyrQ71hQc872LxydZS%2F3aU1JXFbp4raQ1KvY908BcKBeSBtXFgBY9IS9ZaLEDi" target="_blank" rel="noopener">MySQL Binlog 介绍</a>》</p>
<pre><code>$ vi my.cnf

[mysqld]
server_id=1
log-bin=master
binlog_format=row
</code></pre><p>创建Maxwell用户，并赋予 maxwell 库的一些权限</p>
<pre><code class="sql">CREATE USER &#39;maxwell&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON maxwell.* TO &#39;maxwell&#39;@&#39;%&#39;;
GRANT SELECT, REPLICATION CLIENT, REPLICATION SLAVE on *.* to &#39;maxwell&#39;@&#39;%&#39;; 
</code></pre>
<p>使用 maxwell 之前需要先启动 kafka</p>
<pre><code>wget http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.1.0/kafka_2.11-2.1.0.tgz
tar -xzf kafka_2.11-2.1.0.tgz
cd kafka_2.11-2.1.0
# 启动Zookeeper
bin/zookeeper-server-start.sh config/zookeeper.properties
</code></pre><p>单机启动 kafka 之前，需要修改一下配置文件，打开配置文件 <code>vi config/server.properties</code>，在文件最后加入 <code>advertised.host.name</code> 的配置，值为 kafka 所在机器的IP</p>
<pre><code>advertised.host.name=10.100.97.246
</code></pre><p>不然后面通过 docker 启动 maxwell 将会报异常（其中的 hadoop2 是我的主机名）</p>
<pre><code>17:45:21,446 DEBUG NetworkClient - [Producer clientId=producer-1] Error connecting to node hadoop2:9092 (id: 0 rack: null)
java.io.IOException: Can&#39;t resolve address: hadoop2:9092
        at org.apache.kafka.common.network.Selector.connect(Selector.java:217) ~[kafka-clients-1.0.0.jar:?]
        at org.apache.kafka.clients.NetworkClient.initiateConnect(NetworkClient.java:793) [kafka-clients-1.0.0.jar:?]
        at org.apache.kafka.clients.NetworkClient.ready(NetworkClient.java:230) [kafka-clients-1.0.0.jar:?]
        at org.apache.kafka.clients.producer.internals.Sender.sendProducerData(Sender.java:263) [kafka-clients-1.0.0.jar:?]
        at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:238) [kafka-clients-1.0.0.jar:?]
        at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:176) [kafka-clients-1.0.0.jar:?]
        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]
Caused by: java.nio.channels.UnresolvedAddressException
        at sun.nio.ch.Net.checkAddress(Net.java:101) ~[?:1.8.0_181]
        at sun.nio.ch.SocketChannelImpl.connect(SocketChannelImpl.java:622) ~[?:1.8.0_181]
        at org.apache.kafka.common.network.Selector.connect(Selector.java:214) ~[kafka-clients-1.0.0.jar:?]
        ... 6 more
</code></pre><p>接着可以启动 kafka</p>
<pre><code>bin/kafka-server-start.sh config/server.properties
</code></pre><p>测试 kafka</p>
<pre><code># 创建一个 topic
bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test

# 列出所有 topic
bin/kafka-topics.sh --list --zookeeper localhost:2181

# 启动一个生产者，然后随意发送一些消息
bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
This is a message
This is another message

# 在另一个终端启动一下消费者，观察所消费的消息
bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning
This is a message
This is another message
</code></pre><p>通过 docker 快速安装并使用 Maxwell （当然之前需要自行安装 docker）</p>
<pre><code># 拉取镜像 
docker pull zendesk/maxwell

# 启动maxwell，并将解析出的binlog输出到控制台
docker run -ti --rm zendesk/maxwell bin/maxwell --user=&#39;maxwell&#39; --password=&#39;123456&#39; --host=&#39;10.100.97.246&#39; --producer=stdout
</code></pre><p>测试Maxwell，首先创建一张简单的表，然后增改删数据</p>
<pre><code class="sql">CREATE TABLE `test` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `age` int(11) DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert into test values(1,22,&quot;小旋锋&quot;);
update test set name=&#39;whirly&#39; where id=1;
delete from test where id=1;
</code></pre>
<p>观察docker控制台的输出，从输出的日志中可以看出Maxwell解析出的binlog的JSON字符串的格式</p>
<pre><code>{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;insert&quot;,&quot;ts&quot;:1552153502,&quot;xid&quot;:832,&quot;commit&quot;:true,&quot;data&quot;:{&quot;id&quot;:1,&quot;age&quot;:22,&quot;name&quot;:&quot;小旋锋&quot;}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;update&quot;,&quot;ts&quot;:1552153502,&quot;xid&quot;:833,&quot;commit&quot;:true,&quot;data&quot;:{&quot;id&quot;:1,&quot;age&quot;:22,&quot;name&quot;:&quot;whirly&quot;},&quot;old&quot;:{&quot;name&quot;:&quot;小旋锋&quot;}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;delete&quot;,&quot;ts&quot;:1552153502,&quot;xid&quot;:834,&quot;commit&quot;:true,&quot;data&quot;:{&quot;id&quot;:1,&quot;age&quot;:22,&quot;name&quot;:&quot;whirly&quot;}}
</code></pre><p>输出到 Kafka，关闭 docker，重新设置启动参数</p>
<pre><code>docker run -it --rm zendesk/maxwell bin/maxwell --user=&#39;maxwell&#39; \
    --password=&#39;123456&#39; --host=&#39;10.100.97.246&#39; --producer=kafka \
    --kafka.bootstrap.servers=&#39;10.100.97.246:9092&#39; --kafka_topic=maxwell --log_level=debug
</code></pre><p>然后启动一个消费者来消费 maxwell topic的消息，观察其输出；再一次执行增改删数据的SQL，仍然可以得到相同的输出</p>
<pre><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic maxwell
</code></pre><h4 id="输出JSON字符串的格式"><a href="#输出JSON字符串的格式" class="headerlink" title="输出JSON字符串的格式"></a>输出JSON字符串的格式</h4><ul>
<li>data 最新的数据，修改后的数据</li>
<li>old 旧数据，修改前的数据</li>
<li>type 操作类型，有insert, update, delete, database-create, database-alter, database-drop, table-create, table-alter, table-drop，bootstrap-insert，int(未知类型)</li>
<li>xid 事务id</li>
<li>commit 同一个xid代表同一个事务，事务的最后一条语句会有commit，可以利用这个重现事务</li>
<li>server_id </li>
<li>thread_id </li>
<li>运行程序时添加参数–output_ddl，可以捕捉到ddl语句</li>
<li>datetime列会输出为”YYYY-MM-DD hh:mm:ss”，如果遇到”0000-00-00 00:00:00”会原样输出</li>
<li>maxwell支持多种编码，但仅输出utf8编码</li>
<li>maxwell的TIMESTAMP总是作为UTC处理，如果要调整为自己的时区，需要在后端逻辑上进行处理</li>
</ul>
<p>与输出格式相关的配置如下</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>参数值</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output_binlog_position</code></td>
<td>BOOLEAN</td>
<td>是否包含 binlog position</td>
<td>false</td>
</tr>
<tr>
<td><code>output_gtid_position</code></td>
<td>BOOLEAN</td>
<td>是否包含 gtid position</td>
<td>false</td>
</tr>
<tr>
<td><code>output_commit_info</code></td>
<td>BOOLEAN</td>
<td>是否包含 commit and xid</td>
<td>true</td>
</tr>
<tr>
<td><code>output_xoffset</code></td>
<td>BOOLEAN</td>
<td>是否包含 virtual tx-row offset</td>
<td>false</td>
</tr>
<tr>
<td><code>output_nulls</code></td>
<td>BOOLEAN</td>
<td>是否包含值为NULL的字段</td>
<td>true</td>
</tr>
<tr>
<td><code>output_server_id</code></td>
<td>BOOLEAN</td>
<td>是否包含 server_id</td>
<td>false</td>
</tr>
<tr>
<td><code>output_thread_id</code></td>
<td>BOOLEAN</td>
<td>是否包含 thread_id</td>
<td>false</td>
</tr>
<tr>
<td><code>output_schema_id</code></td>
<td>BOOLEAN</td>
<td>是否包含 schema_id</td>
<td>false</td>
</tr>
<tr>
<td><code>output_row_query</code></td>
<td>BOOLEAN</td>
<td>是否包含 INSERT/UPDATE/DELETE 语句. Mysql需要开启 <code>binlog_rows_query_log_events</code></td>
<td>false</td>
</tr>
<tr>
<td><code>output_ddl</code></td>
<td>BOOLEAN</td>
<td>是否包含 DDL (table-alter, table-create, etc) events</td>
<td>false</td>
</tr>
<tr>
<td><code>output_null_zerodates</code></td>
<td>BOOLEAN</td>
<td>是否将 ‘0000-00-00’ 转换为 null?</td>
<td>false</td>
</tr>
</tbody>
</table>
<h3 id="进阶使用"><a href="#进阶使用" class="headerlink" title="进阶使用"></a>进阶使用</h3><h4 id="基本的配置"><a href="#基本的配置" class="headerlink" title="基本的配置"></a>基本的配置</h4><table>
<thead>
<tr>
<th>选项</th>
<th>参数值</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>config</code></td>
<td></td>
<td>配置文件 <code>config.properties</code> 的路径</td>
<td></td>
</tr>
<tr>
<td><code>log_level</code></td>
<td><code>debug,info,warn,error</code></td>
<td>日志级别</td>
<td>info</td>
</tr>
<tr>
<td><code>daemon</code></td>
<td></td>
<td>指定Maxwell实例作为守护进程到后台运行</td>
<td></td>
</tr>
<tr>
<td><code>env_config_prefix</code></td>
<td>STRING</td>
<td>匹配该前缀的环境变量将被视为配置值</td>
</tr>
</tbody>
</table>
<p>可以把Maxwell的启动参数写到一个配置文件 <code>config.properties</code> 中，然后通过 config 选项指定，<code>bin/maxwell --config config.properties</code></p>
<pre><code>user=maxwell
password=123456
host=10.100.97.246
producer=kafka
kafka.bootstrap.servers=10.100.97.246:9092
kafka_topic=maxwell
</code></pre><h4 id="mysql-配置选项"><a href="#mysql-配置选项" class="headerlink" title="mysql 配置选项"></a>mysql 配置选项</h4><p>Maxwell 根据用途将 MySQL 划分为3种角色：</p>
<ul>
<li><p><code>host</code>：主机，建maxwell库表，存储捕获到的schema等信息</p>
<ul>
<li>主要有六张表，bootstrap用于数据初始化，schemas记录所有的binlog文件信息，databases记录了所有的数据库信息，tables记录了所有的表信息，columns记录了所有的字段信息，positions记录了读取binlog的位移信息，heartbeats记录了心跳信息</li>
</ul>
</li>
<li><p><code>replication_host</code>：复制主机，Event监听，读取该主机binlog</p>
<ul>
<li>将<code>host</code>和<code>replication_host</code>分开，可以避免 <code>replication_user</code> 往生产库里写数据</li>
</ul>
</li>
<li><p><code>schema_host</code>：schema主机，捕获表结构schema的主机</p>
<ul>
<li>binlog里面没有字段信息，所以maxwell需要从数据库查出schema，存起来。</li>
<li><code>schema_host</code>一般用不到，但在<code>binlog-proxy</code>场景下就很实用。比如要将已经离线的binlog通过maxwell生成json流，于是自建一个mysql server里面没有结构，只用于发送binlog，此时表机构就可以制动从 schema_host 获取。</li>
</ul>
</li>
</ul>
<p>通常，这三个主机都是同一个，<code>schema_host</code> 只在有 <code>replication_host</code> 的时候使用。</p>
<p>与MySQL相关的有下列配置</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>参数值</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td>STRING</td>
<td>mysql 地址</td>
<td>localhost</td>
</tr>
<tr>
<td><code>user</code></td>
<td>STRING</td>
<td>mysql 用户名</td>
<td></td>
</tr>
<tr>
<td><code>password</code></td>
<td>STRING</td>
<td>mysql 密码</td>
<td>(no password)</td>
</tr>
<tr>
<td><code>port</code></td>
<td>INT</td>
<td>mysql 端口    3306</td>
<td></td>
</tr>
<tr>
<td><code>jdbc_options</code></td>
<td>STRING</td>
<td>mysql jdbc connection options</td>
<td>DEFAULT_JDBC_OPTS</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td>SSL_OPT</td>
<td>SSL behavior for mysql cx</td>
<td>DISABLED</td>
</tr>
<tr>
<td><code>schema_database</code></td>
<td>STRING</td>
<td>Maxwell用于维护的schema和position将使用的数据库</td>
<td>maxwell</td>
</tr>
<tr>
<td><code>client_id</code></td>
<td>STRING</td>
<td>用于标识Maxwell实例的唯一字符串</td>
<td>maxwell</td>
</tr>
<tr>
<td><code>replica_server_id</code></td>
<td>LONG</td>
<td>用于标识Maxwell实例的唯一数字</td>
<td>6379 (see notes)</td>
</tr>
<tr>
<td><code>master_recovery</code></td>
<td>BOOLEAN</td>
<td>enable experimental master recovery code</td>
<td>false</td>
</tr>
<tr>
<td><code>gtid_mode</code></td>
<td>BOOLEAN</td>
<td>是否开启基于GTID的复制</td>
<td>false</td>
</tr>
<tr>
<td><code>recapture_schema</code></td>
<td>BOOLEAN</td>
<td>重新捕获最新的表结构(schema)，不可在 config.properties中配置</td>
<td>false</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>replication_host</code></td>
<td>STRING</td>
<td>server to replicate from. See split server roles</td>
<td>schema-store host</td>
</tr>
<tr>
<td><code>replication_password</code></td>
<td>STRING</td>
<td>password on replication server</td>
<td>(none)</td>
</tr>
<tr>
<td><code>replication_port</code></td>
<td>INT</td>
<td>port on replication server</td>
<td>3306</td>
</tr>
<tr>
<td><code>replication_user</code></td>
<td>STRING</td>
<td>user on replication server</td>
<td></td>
</tr>
<tr>
<td><code>replication_ssl</code></td>
<td>SSL_OPT</td>
<td>SSL behavior for replication cx cx</td>
<td>DISABLED</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>schema_host</code></td>
<td>STRING</td>
<td>server to capture schema from. See split server roles</td>
<td>schema-store host</td>
</tr>
<tr>
<td><code>schema_password</code></td>
<td>STRING</td>
<td>password on schema-capture server</td>
<td>(none)</td>
</tr>
<tr>
<td><code>schema_port</code></td>
<td>INT</td>
<td>port on schema-capture server</td>
<td>3306</td>
</tr>
<tr>
<td><code>schema_user</code></td>
<td>STRING</td>
<td>user on schema-capture server</td>
<td></td>
</tr>
<tr>
<td><code>schema_ssl</code></td>
<td>SSL_OPT</td>
<td>SSL behavior for schema-capture server</td>
<td>DISABLED</td>
</tr>
</tbody>
</table>
<h4 id="生产者的配置"><a href="#生产者的配置" class="headerlink" title="生产者的配置"></a>生产者的配置</h4><p>仅介绍kafka，其他的生产者的配置详见官方文档。</p>
<p>kafka是maxwell支持最完善的一个生产者，并且内置了多个版本的kafka客户端(0.8.2.2, 0.9.0.1, 0.10.0.1, 0.10.2.1 or 0.11.0.1, 1.0.0.)，默认 kafka_version=1.0.0（当前Maxwell版本1.20.0）</p>
<p>Maxwell 会将消息投递到Kafka的Topic中，该Topic由 <code>kafka_topic</code> 选项指定，默认值为 <code>maxwell</code>，除了指定为静态的Topic，还可以指定为动态的，譬如 <code>namespace_%{database}_%{table}</code>，<code>%{database}</code> 和 <code>%{table}</code> 将被具体的消息的 database 和 table 替换。</p>
<p>Maxwell 读取配置时，如果配置项是以 <code>kafka.</code> 开头，那么该配置将设置到 Kafka Producer 客户端的连接参数中去，譬如</p>
<pre><code>kafka.acks = 1
kafka.compression.type = snappy
kafka.retries=5
</code></pre><p>下面是Maxwell通用生产者和Kafka生产者的配置参数</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>参数值</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>producer</code></td>
<td>PRODUCER_TYPE</td>
<td>生产者类型</td>
<td>stdout</td>
</tr>
<tr>
<td><code>custom_producer.factory</code></td>
<td>CLASS_NAME</td>
<td>自定义消费者的工厂类</td>
<td></td>
</tr>
<tr>
<td><code>producer_ack_timeout</code></td>
<td>PRODUCER_ACK_TIMEOUT</td>
<td>异步消费认为消息丢失的超时时间（毫秒ms）</td>
<td></td>
</tr>
<tr>
<td><code>producer_partition_by</code></td>
<td>PARTITION_BY</td>
<td>输入到kafka/kinesis的分区函数</td>
<td>database</td>
</tr>
<tr>
<td><code>producer_partition_columns</code></td>
<td>STRING</td>
<td>若按列分区，以逗号分隔的列名称</td>
<td></td>
</tr>
<tr>
<td><code>producer_partition_by_fallback</code></td>
<td>PARTITION_BY_FALLBACK</td>
<td><code>producer_partition_by=column</code>时需要，当列不存在是使用</td>
<td></td>
</tr>
<tr>
<td><code>ignore_producer_error</code></td>
<td>BOOLEAN</td>
<td>为false时，在kafka/kinesis发生错误时退出程序；为true时，仅记录日志 See also <code>dead_letter_topic</code></td>
<td>true</td>
</tr>
<tr>
<td><code>kafka.bootstrap.servers</code></td>
<td>STRING</td>
<td>kafka 集群列表，<code>HOST:PORT[,HOST:PORT]</code></td>
<td></td>
</tr>
<tr>
<td><code>kafka_topic</code></td>
<td>STRING</td>
<td>kafka topic</td>
<td>maxwell</td>
</tr>
<tr>
<td><code>dead_letter_topic</code></td>
<td>STRING</td>
<td>详见官方文档</td>
<td></td>
</tr>
<tr>
<td><code>kafka_version</code></td>
<td>KAFKA_VERSION</td>
<td>指定maxwell的 kafka 生产者客户端版本，不可在config.properties中配置</td>
<td>0.11.0.1</td>
</tr>
<tr>
<td><code>kafka_partition_hash</code></td>
<td><code>default,murmur3</code></td>
<td>选择kafka分区时使用的hash方法</td>
<td>default</td>
</tr>
<tr>
<td><code>kafka_key_format</code></td>
<td><code>array,hash</code></td>
<td>how maxwell outputs kafka keys, either a hash or an array of hashes</td>
<td>hash</td>
</tr>
<tr>
<td><code>ddl_kafka_topic</code></td>
<td>STRING</td>
<td>当<code>output_ddl</code>为true时, 所有DDL的消息都将投递到该topic</td>
<td><code>kafka_topic</code></td>
</tr>
</tbody>
</table>
<h4 id="过滤器配置"><a href="#过滤器配置" class="headerlink" title="过滤器配置"></a>过滤器配置</h4><p>Maxwell 可以通过 <code>--filter</code> 配置项来指定过滤规则，通过 <code>exclude</code> 排除，通过 <code>include</code> 包含，值可以为具体的数据库、数据表、数据列，甚至用 Javascript 来定义复杂的过滤规则；可以用正则表达式描述，有几个来自官网的例子</p>
<pre><code># 仅匹配foodb数据库的tbl表和所有table_数字的表
--filter=&#39;exclude: foodb.*, include: foodb.tbl, include: foodb./table_\d+/&#39;
# 排除所有库所有表，仅匹配db1数据库
--filter = &#39;exclude: *.*, include: db1.*&#39;
# 排除含db.tbl.col列值为reject的所有更新
--filter = &#39;exclude: db.tbl.col = reject&#39;
# 排除任何包含col_a列的更新
--filter = &#39;exclude: *.*.col_a = *&#39;
# blacklist 黑名单，完全排除bad_db数据库，若要恢复，必须删除maxwell库
--filter = &#39;blacklist: bad_db.*&#39; 
</code></pre><h4 id="数据初始化"><a href="#数据初始化" class="headerlink" title="数据初始化"></a>数据初始化</h4><p>Maxwell 启动后将从maxwell库中获取上一次停止时position，从该断点处开始读取binlog。如果binlog已经清除了，那么怎样可以通过maxwell把整张表都复制出来呢？也就是数据初始化该怎么做？</p>
<p>对整张表进行操作，人为地产生binlog？譬如找一个不影响业务的字段譬如update_time，然后加一秒，再减一秒？ </p>
<pre><code class="sql">update test set update_time = DATE_ADD(update_time,intever 1 second);
update test set update_time = DATE_ADD(update_time,intever -1 second);
</code></pre>
<p>这样明显存在几个大问题：</p>
<ul>
<li>不存在一个不重要的字段怎么办？每个字段都很重要，不能随便地修改！</li>
<li>如果整张表很大，修改的过程耗时很长，影响了业务！</li>
<li>将产生大量非业务的binlog！</li>
</ul>
<p>针对数据初始化的问题，Maxwell 提供了一个命令工具 <code>maxwell-bootstrap</code> 帮助我们完成数据初始化，<code>maxwell-bootstrap</code> 是基于 <code>SELECT * FROM table</code> 的方式进行全量数据初始化，不会产生多余的binlog！</p>
<p>这个工具有下面这些参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--log_level LOG_LEVEL</code></td>
<td>日志级别（DEBUG, INFO, WARN or ERROR）</td>
</tr>
<tr>
<td><code>--user USER</code></td>
<td>mysql 用户名</td>
</tr>
<tr>
<td><code>--password PASSWORD</code></td>
<td>mysql 密码</td>
</tr>
<tr>
<td><code>--host HOST</code></td>
<td>mysql 地址</td>
</tr>
<tr>
<td><code>--port PORT</code></td>
<td>mysql 端口</td>
</tr>
<tr>
<td><code>--database DATABASE</code></td>
<td>要bootstrap的表所在的数据库</td>
</tr>
<tr>
<td><code>--table TABLE</code></td>
<td>要引导的表</td>
</tr>
<tr>
<td><code>--where WHERE_CLAUSE</code></td>
<td>设置过滤条件</td>
</tr>
<tr>
<td><code>--client_id CLIENT_ID</code></td>
<td>指定执行引导操作的Maxwell实例</td>
</tr>
</tbody>
</table>
<p>实验一番，下面将引导 <code>test</code> 数据库中 <code>test</code> 表，首先是准备几条测试用的数据</p>
<pre><code class="sql">INSERT INTO `test` VALUES (1, 1, &#39;1&#39;);
INSERT INTO `test` VALUES (2, 2, &#39;2&#39;);
INSERT INTO `test` VALUES (3, 3, &#39;3&#39;);
INSERT INTO `test` VALUES (4, 4, &#39;4&#39;);
</code></pre>
<p>然后 <code>reset master;</code> 清空binlog，删除 maxwell 库中的表。接着使用快速开始中的命令，启动Kafka、Maxwell和Kafka消费者，然后启动 <code>maxwell-bootstrap</code></p>
<pre><code>docker run -it --rm zendesk/maxwell bin/maxwell-bootstrap --user maxwell  \
    --password 123456 --host 10.100.97.246  --database test --table test --client_id maxwell
</code></pre><p>注意：<code>--bootstrapper=sync</code> 时，在处理bootstrap时，会阻塞正常的binlog解析；<code>--bootstrapper=async</code> 时，不会阻塞。</p>
<p>也可以执行下面的SQL，在 <code>maxwell.bootstrap</code> 表中插入记录，手动触发</p>
<pre><code class="sql">insert into maxwell.bootstrap (database_name, table_name) values (&#39;test&#39;, &#39;test&#39;);
</code></pre>
<p>就可以在 kafka 消费者端看见引导过来的数据了</p>
<pre><code>{&quot;database&quot;:&quot;maxwell&quot;,&quot;table&quot;:&quot;bootstrap&quot;,&quot;type&quot;:&quot;insert&quot;,&quot;ts&quot;:1552199115,&quot;xid&quot;:36738,&quot;commit&quot;:true,&quot;data&quot;:{&quot;id&quot;:3,&quot;database_name&quot;:&quot;test&quot;,&quot;table_name&quot;:&quot;test&quot;,&quot;where_clause&quot;:null,&quot;is_complete&quot;:0,&quot;inserted_rows&quot;:0,&quot;total_rows&quot;:0,&quot;created_at&quot;:null,&quot;started_at&quot;:null,&quot;completed_at&quot;:null,&quot;binlog_file&quot;:null,&quot;binlog_position&quot;:0,&quot;client_id&quot;:&quot;maxwell&quot;}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;bootstrap-start&quot;,&quot;ts&quot;:1552199115,&quot;data&quot;:{}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;bootstrap-insert&quot;,&quot;ts&quot;:1552199115,&quot;data&quot;:{&quot;id&quot;:1,&quot;age&quot;:1,&quot;name&quot;:&quot;1&quot;}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;bootstrap-insert&quot;,&quot;ts&quot;:1552199115,&quot;data&quot;:{&quot;id&quot;:2,&quot;age&quot;:2,&quot;name&quot;:&quot;2&quot;}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;bootstrap-insert&quot;,&quot;ts&quot;:1552199115,&quot;data&quot;:{&quot;id&quot;:3,&quot;age&quot;:3,&quot;name&quot;:&quot;3&quot;}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;bootstrap-insert&quot;,&quot;ts&quot;:1552199115,&quot;data&quot;:{&quot;id&quot;:4,&quot;age&quot;:4,&quot;name&quot;:&quot;4&quot;}}
{&quot;database&quot;:&quot;maxwell&quot;,&quot;table&quot;:&quot;bootstrap&quot;,&quot;type&quot;:&quot;update&quot;,&quot;ts&quot;:1552199115,&quot;xid&quot;:36756,&quot;commit&quot;:true,&quot;data&quot;:{&quot;id&quot;:3,&quot;database_name&quot;:&quot;test&quot;,&quot;table_name&quot;:&quot;test&quot;,&quot;where_clause&quot;:null,&quot;is_complete&quot;:1,&quot;inserted_rows&quot;:4,&quot;total_rows&quot;:0,&quot;created_at&quot;:null,&quot;started_at&quot;:&quot;2019-03-10 14:25:15&quot;,&quot;completed_at&quot;:&quot;2019-03-10 14:25:15&quot;,&quot;binlog_file&quot;:&quot;mysql-bin.000001&quot;,&quot;binlog_position&quot;:64446,&quot;client_id&quot;:&quot;maxwell&quot;},&quot;old&quot;:{&quot;is_complete&quot;:0,&quot;inserted_rows&quot;:1,&quot;completed_at&quot;:null}}
{&quot;database&quot;:&quot;test&quot;,&quot;table&quot;:&quot;test&quot;,&quot;type&quot;:&quot;bootstrap-complete&quot;,&quot;ts&quot;:1552199115,&quot;data&quot;:{}}
</code></pre><p>中间的4条便是 <code>test.test</code> 的binlog数据了，注意这里的 type 是 <code>bootstrap-insert</code>，而不是 <code>insert</code>。</p>
<p>然后再一次查看binlog，<code>show binlog events;</code>，会发现只有与 <code>maxwell</code> 相关的binlog，并没有 <code>test.test</code> 相关的binlog，所以 <code>maxwell-bootstrap</code> 命令并不会产生多余的 binlog，当数据表的数量很大时，这个好处会更加明显</p>
<p>Bootstrap 的过程是 <code>bootstrap-start -&gt; bootstrap-insert -&gt; bootstrap-complete</code>，其中，start和complete的data字段为空，不携带数据。</p>
<p>在进行bootstrap过程中，如果maxwell崩溃，重启时，bootstrap会完全重新开始，不管之前进行到多少，若不希望这样，可以到数据库中设置 <code>is_complete</code> 字段值为1(表示完成)，或者删除该行</p>
<h4 id="Maxwell监控"><a href="#Maxwell监控" class="headerlink" title="Maxwell监控"></a>Maxwell监控</h4><p>Maxwell 提供了 <code>base logging mechanism, JMX, HTTP or by push to Datadog</code> 这四种监控方式，与监控相关的配置项有下列这些：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>参数值</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>metrics_prefix</code></td>
<td>STRING</td>
<td>指标的前缀</td>
<td>MaxwellMetrics</td>
</tr>
<tr>
<td><code>metrics_type</code></td>
<td><code>slf4j,jmx,http,datadog</code></td>
<td>发布指标的方式</td>
<td></td>
</tr>
<tr>
<td><code>metrics_jvm</code></td>
<td>BOOLEAN</td>
<td>是否收集JVM信息</td>
<td>false</td>
</tr>
<tr>
<td><code>metrics_slf4j_interval</code></td>
<td>SECONDS</td>
<td>将指标记录到日志的频率，<code>metrics_type</code>须配置为slf4j</td>
<td>60</td>
</tr>
<tr>
<td><code>http_port</code></td>
<td>INT</td>
<td><code>metrics_type</code>为http时，发布指标绑定的端口</td>
<td>8080</td>
</tr>
<tr>
<td><code>http_path_prefix</code></td>
<td>STRING</td>
<td>http的路径前缀</td>
<td>/</td>
</tr>
<tr>
<td><code>http_bind_address</code></td>
<td>STRING</td>
<td>http发布指标绑定的地址</td>
<td>all addresses</td>
</tr>
<tr>
<td><code>http_diagnostic</code></td>
<td>BOOLEAN</td>
<td>http是否开启diagnostic后缀</td>
<td>false</td>
</tr>
<tr>
<td><code>http_diagnostic_timeout</code></td>
<td>MILLISECONDS</td>
<td>http diagnostic 响应超时时间</td>
<td>10000</td>
</tr>
<tr>
<td><code>metrics_datadog_type</code></td>
<td><code>udp,http</code></td>
<td><code>metrics_type</code>为datadog时发布指标的方式</td>
<td>udp</td>
</tr>
<tr>
<td><code>metrics_datadog_tags</code></td>
<td>STRING</td>
<td>提供给 datadog 的标签，如 tag1:value1,tag2:value2</td>
<td></td>
</tr>
<tr>
<td><code>metrics_datadog_interval</code></td>
<td>INT</td>
<td>推指标到datadog的频率，单位秒</td>
<td>60</td>
</tr>
<tr>
<td><code>metrics_datadog_apikey</code></td>
<td>STRING</td>
<td>当 <code>metrics_datadog_type=http</code> 时datadog用的api key</td>
<td></td>
</tr>
<tr>
<td><code>metrics_datadog_host</code></td>
<td>STRING</td>
<td>当<code>metrics_datadog_type=udp</code>时推指标的目标地址</td>
<td>localhost</td>
</tr>
<tr>
<td><code>metrics_datadog_port</code></td>
<td>INT</td>
<td>当<code>metrics_datadog_type=udp</code> 时推指标的端口</td>
<td>8125</td>
</tr>
</tbody>
</table>
<p>具体可以得到哪些监控指标呢？有如下，注意所有指标都预先配置了指标前缀 <code>metrics_prefix</code></p>
<table>
<thead>
<tr>
<th>指标</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>messages.succeeded</code></td>
<td>Counters</td>
<td>成功发送到kafka的消息数量</td>
</tr>
<tr>
<td><code>messages.failed</code></td>
<td>Counters</td>
<td>发送失败的消息数量</td>
</tr>
<tr>
<td><code>row.count</code></td>
<td>Counters</td>
<td>已处理的binlog行数，注意并非所有binlog都发往kafka</td>
</tr>
<tr>
<td><code>messages.succeeded.meter</code></td>
<td>Meters</td>
<td>消息成功发送到Kafka的速率</td>
</tr>
<tr>
<td><code>messages.failed.meter</code></td>
<td>Meters</td>
<td>消息发送失败到kafka的速率</td>
</tr>
<tr>
<td><code>row.meter</code></td>
<td>Meters</td>
<td>行(row)从binlog连接器到达maxwell的速率</td>
</tr>
<tr>
<td><code>replication.lag</code></td>
<td>Gauges</td>
<td>从数据库事务提交到Maxwell处理该事务之间所用的时间（毫秒）</td>
</tr>
<tr>
<td><code>inflightmessages.count</code></td>
<td>Gauges</td>
<td>当前正在处理的消息数（等待来自目的地的确认，或在消息之前）</td>
</tr>
<tr>
<td><code>message.publish.time</code></td>
<td>Timers</td>
<td>向kafka发送record所用的时间（毫秒）</td>
</tr>
<tr>
<td><code>message.publish.age</code></td>
<td>Timers</td>
<td>从数据库产生事件到发送到Kafka之间的时间（毫秒），精确度为+/-500ms</td>
</tr>
<tr>
<td><code>replication.queue.time</code></td>
<td>Timers</td>
<td>将一个binlog事件送到处理队列所用的时间（毫秒）</td>
</tr>
</tbody>
</table>
<p>上述有些指标为kafka特有的，并不支持所有的生产者。</p>
<p>实验一番，通过 http 方式获取监控指标</p>
<pre><code>docker run -p 8080:8080 -it --rm zendesk/maxwell bin/maxwell --user=&#39;maxwell&#39; \
    --password=&#39;123456&#39; --host=&#39;10.100.97.246&#39; --producer=kafka \
    --kafka.bootstrap.servers=&#39;10.100.97.246:9092&#39; --kafka_topic=maxwell --log_level=debug \
    --metrics_type=http  --metrics_jvm=true --http_port=8080
</code></pre><p>上面的配置大部分与前面的相同，不同的有 <code>-p 8080:8080</code> docker端口映射，以及 <code>--metrics_type=http  --metrics_jvm=true --http_port=8080</code>，配置了通过http方式发布指标，启用收集JVM信息，端口为8080，之后可以通过 <code>http://10.100.97.246:8080/metrics</code> 便可获取所有的指标</p>
<p><img src="http://image.laijianfeng.org/20190310_234508.png" alt="Maxwell监控"></p>
<p>http 方式有四种后缀，分别对应四种不同的格式</p>
<table>
<thead>
<tr>
<th>endpoint</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/metrics</code></td>
<td>所有指标以JSON格式返回</td>
</tr>
<tr>
<td><code>/prometheus</code></td>
<td>所有指标以Prometheus格式返回（Prometheus是一套开源的监控&amp;报警&amp;时间序列数据库的组合）</td>
</tr>
<tr>
<td><code>/healthcheck</code></td>
<td>返回Maxwell过去15分钟是否健康</td>
</tr>
<tr>
<td><code>/ping</code></td>
<td>简单的测试，返回 <code>pong</code></td>
</tr>
</tbody>
</table>
<p>如果是通过 JMX 的方式收集Maxwell监控指标，可以 <code>JAVA_OPTS</code> 环境变量配置JMX访问权限</p>
<pre><code>export JAVA_OPTS=&quot;-Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.port=9010 \
-Dcom.sun.management.jmxremote.local.only=false \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-Djava.rmi.server.hostname=10.100.97.246&quot;
</code></pre><h4 id="多个Maxwell实例"><a href="#多个Maxwell实例" class="headerlink" title="多个Maxwell实例"></a>多个Maxwell实例</h4><p>在不同的配置下，Maxwell可以在同一个主服务器上运行多个实例。如果希望让生产者以不同的配置运行，例如将来自不同组的表(table)的事件投递到不同的Topic中，这将非常有用。Maxwell的每个实例都必须配置一个唯一的client_id，以便区分的binlog位置。</p>
<h4 id="GTID-支持"><a href="#GTID-支持" class="headerlink" title="GTID 支持"></a>GTID 支持</h4><p>Maxwell 从1.8.0版本开始支持基于GTID的复制(<a href="https://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html" target="_blank" rel="noopener">GTID-based replication</a>)，在GTID模式下，Maxwell将在主机更改后透明地选择新的复制位置。</p>
<p><strong>什么是GTID Replication？</strong></p>
<p>GTID (Global Transaction ID) 是对于一个已提交事务的编号，并且是一个全局唯一的编号。</p>
<p>从 MySQL 5.6.5 开始新增了一种基于 GTID 的复制方式。通过 GTID 保证了每个在主库上提交的事务在集群中有一个唯一的ID。这种方式强化了数据库的主备一致性，故障恢复以及容错能力。</p>
<p>在原来基于二进制日志的复制中，从库需要告知主库要从哪个偏移量进行增量同步，如果指定错误会造成数据的遗漏，从而造成数据的不一致。借助GTID，在发生主备切换的情况下，MySQL的其它从库可以自动在新主库上找到正确的复制位置，这大大简化了复杂复制拓扑下集群的维护，也减少了人为设置复制位置发生误操作的风险。另外，基于GTID的复制可以忽略已经执行过的事务，减少了数据发生不一致的风险。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><h4 id="timestamp-column"><a href="#timestamp-column" class="headerlink" title="timestamp column"></a>timestamp column</h4><p>maxwell对时间类型（datetime, timestamp, date）都是<strong>当做字符串处理</strong>的，这也是为了保证数据一致(比如<code>0000-00-00 00:00:00</code>这样的时间在timestamp里是非法的，但mysql却认，解析成java或者python类型就是null/None)。</p>
<p>如果MySQL表上的字段是 timestamp 类型，是有时区的概念，<strong>binlog解析出来的是标准UTC时间</strong>，但用户看到的是本地时间。比如 <code>f_create_time timestamp</code> 创建时间是北京时间 <code>2018-01-05 21:01:01</code>，那么mysql实际存储的是 <code>2018-01-05 13:01:01</code>，binlog里面也是这个时间字符串。如果不做消费者不做时区转换，会少8个小时。</p>
<p>与其每个客户端都要考虑这个问题，我觉得更合理的做法是提供时区参数，然后maxwell自动处理时区问题，否则要么客户端先需要知道哪些列是timestamp类型，或者连接上原库缓存上这些类型。</p>
<h4 id="binary-column"><a href="#binary-column" class="headerlink" title="binary column"></a>binary column</h4><p>maxwell可以处理binary类型的列，如blob、varbinary，它的做法就是对二进制列使用 <code>base64_encode</code>，当做字符串输出到json。消费者拿到这个列数据后，不能直接拼装，需要 <code>base64_decode</code>。</p>
<h4 id="表结构不同步"><a href="#表结构不同步" class="headerlink" title="表结构不同步"></a>表结构不同步</h4><p>如果是拿比较老的binlog，放到新的mysql server上去用maxwell拉去，有可能表结构已经发生了变化，比如binlog里面字段比 <code>schema_host</code> 里面的字段多一个。目前这种情况没有发现异常，比如阿里RDS默认会为 无主键无唯一索引的表，增加一个<code>__##alibaba_rds_rowid##__</code>，在 <code>show create table</code> 和 <code>schema</code> 里面都看不到这个隐藏主键，但binlog里面会有，同步到从库。</p>
<p>另外我们有通过git去管理结构版本，如果真有这种场景，也可以应对。</p>
<h4 id="大事务binlog"><a href="#大事务binlog" class="headerlink" title="大事务binlog"></a>大事务binlog</h4><p>当一个事物产生的binlog量非常大的时候，比如迁移日表数据，maxwell为了控制内存使用，会自动将处理不过来的binlog放到文件系统</p>
<pre><code>Using kafka version: 0.11.0.1
21:16:07,109 WARN  MaxwellMetrics - Metrics will not be exposed: metricsReportingType not configured.
21:16:07,380 INFO  SchemaStoreSchema - Creating maxwell database
21:16:07,540 INFO  Maxwell - Maxwell v?? is booting (RabbitmqProducer), starting at Position[BinlogPosition[mysql-bin.006235:24980714],
lastHeartbeat=0]
21:16:07,649 INFO  AbstractSchemaStore - Maxwell is capturing initial schema
21:16:08,267 INFO  BinlogConnectorReplicator - Setting initial binlog pos to: mysql-bin.006235:24980714
21:16:08,324 INFO  BinaryLogClient - Connected to rm-xxxxxxxxxxx.mysql.rds.aliyuncs.com:3306 at mysql-bin.006235/24980714 (sid:637
9, cid:9182598)
21:16:08,325 INFO  BinlogConnectorLifecycleListener - Binlog connected.
03:15:36,104 INFO  ListWithDiskBuffer - Overflowed in-memory buffer, spilling over into /tmp/maxwell7935334910787514257events
03:17:14,880 INFO  ListWithDiskBuffer - Overflowed in-memory buffer, spilling over into /tmp/maxwell3143086481692829045events
</code></pre><p>但是遇到另外一个问题，overflow随后就出现异常 <code>EventDataDeserializationException: Failed to deserialize data of EventHeaderV4</code>，当我另起一个maxwell指点之前的binlog postion开始解析，却有没有抛异常。事后的数据也表明并没有数据丢失。</p>
<p>问题产生的原因还不明，<code>Caused by: java.net.SocketException: Connection reset</code>，感觉像读取 binlog 流的时候还没读取到完整的event，异常关闭了连接。这个问题比较顽固，github上面类似问题都没有达到明确的解决。（这也从侧面告诉我们，大表数据迁移，也要批量进行，不要一个<code>insert into .. select</code> 搞定）</p>
<pre><code>03:18:20,586 INFO  ListWithDiskBuffer - Overflowed in-memory buffer, spilling over into /tmp/maxwell5229190074667071141events
03:19:31,289 WARN  BinlogConnectorLifecycleListener - Communication failure.
com.github.shyiko.mysql.binlog.event.deserialization.EventDataDeserializationException: Failed to deserialize data of EventHeaderV4{time
stamp=1514920657000, eventType=WRITE_ROWS, serverId=2115082720, headerLength=19, dataLength=8155, nextPosition=520539918, flags=0}
        at com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer.deserializeEventData(EventDeserializer.java:216) ~[mys
ql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer.nextEvent(EventDeserializer.java:184) ~[mysql-binlog-c
onnector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets(BinaryLogClient.java:890) [mysql-binlog-connector-java-0
.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.BinaryLogClient.connect(BinaryLogClient.java:559) [mysql-binlog-connector-java-0.13.0.jar:0.13
.0]
        at com.github.shyiko.mysql.binlog.BinaryLogClient$7.run(BinaryLogClient.java:793) [mysql-binlog-connector-java-0.13.0.jar:0.13.0
]
        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]
Caused by: java.net.SocketException: Connection reset
        at java.net.SocketInputStream.read(SocketInputStream.java:210) ~[?:1.8.0_121]
        at java.net.SocketInputStream.read(SocketInputStream.java:141) ~[?:1.8.0_121]
        at com.github.shyiko.mysql.binlog.io.BufferedSocketInputStream.read(BufferedSocketInputStream.java:51) ~[mysql-binlog-connector-
java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.io.ByteArrayInputStream.readWithinBlockBoundaries(ByteArrayInputStream.java:202) ~[mysql-binlo
g-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.io.ByteArrayInputStream.read(ByteArrayInputStream.java:184) ~[mysql-binlog-connector-java-0.13
.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.io.ByteArrayInputStream.readInteger(ByteArrayInputStream.java:46) ~[mysql-binlog-connector-jav
a-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.AbstractRowsEventDataDeserializer.deserializeLong(AbstractRowsEventDataD
eserializer.java:212) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.AbstractRowsEventDataDeserializer.deserializeCell(AbstractRowsEventDataD
eserializer.java:150) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.AbstractRowsEventDataDeserializer.deserializeRow(AbstractRowsEventDataDeserializer.java:132) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.WriteRowsEventDataDeserializer.deserializeRows(WriteRowsEventDataDeserializer.java:64) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.WriteRowsEventDataDeserializer.deserialize(WriteRowsEventDataDeserializer.java:56) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.WriteRowsEventDataDeserializer.deserialize(WriteRowsEventDataDeserializer.java:32) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        at com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer.deserializeEventData(EventDeserializer.java:210) ~[mysql-binlog-connector-java-0.13.0.jar:0.13.0]
        ... 5 more
03:19:31,514 INFO  BinlogConnectorLifecycleListener - Binlog disconnected.
03:19:31,590 WARN  BinlogConnectorReplicator - replicator stopped at position: mysql-bin.006236:520531744 -- restarting
03:19:31,595 INFO  BinaryLogClient - Connected to rm-xxxxxx.mysql.rds.aliyuncs.com:3306 at mysql-bin.006236/520531744 (sid:6379, cid:9220521)
</code></pre><h4 id="tableMapCache"><a href="#tableMapCache" class="headerlink" title="tableMapCache"></a>tableMapCache</h4><p>前面讲过，如果我只想获取某几个表的binlog变更，需要用 include_tables 来过滤，但如果mysql server上现在删了一个表t1，但我的binlog是从昨天开始读取，被删的那个表t1在maxwell启动的时候是拉取不到表结构的。然后昨天的binlog里面有 t1 的变更，因为找不到表结构给来组装成json，会抛异常。</p>
<p>手动在 <code>maxwell.tables/columns</code> 里面插入记录是可行的。但这个问题的根本是，maxwell在binlog过滤的时候，只在处理row_event的时候，而对 tableMapCache 要求binlog里面的所有表都要有。</p>
<p>自己（seanlook）提交了一个commit，可以在做 tableMapCache 的时候也仅要求缓存 include_dbs/tables 这些表： <a href="https://github.com/seanlook/maxwell/commit/2618b70303078bf910a1981b69943cca75ee04fb" target="_blank" rel="noopener">https://github.com/seanlook/maxwell/commit/2618b70303078bf910a1981b69943cca75ee04fb</a></p>
<h4 id="提高消费性能"><a href="#提高消费性能" class="headerlink" title="提高消费性能"></a>提高消费性能</h4><p>在用rabbitmq时，<code>routing_key</code> 是 <code>%db%.%table%</code>，但某些表产生的binlog增量非常大，就会导致各队列消息量很不平均，目前因为还没做到事务xid或者thread_id级别的并发回放，所以最小队列粒度也是表，尽量单独放一个队列，其它数据量小的合在一起。</p>
<h4 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h4><p>Maxwell 在 maxwell 库中维护了 binlog 的位移等信息，由于一些原因譬如 <code>reset master;</code>，导致 maxwell 库中的记录与实际的binlog对不上，这时将报异常，这是可以手动修正binlog位移或者直接清空/删除 maxwell 库重建</p>
<pre><code>com.github.shyiko.mysql.binlog.network.ServerException: Could not find first log file name in binary log index file
        at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets(BinaryLogClient.java:885)
        at com.github.shyiko.mysql.binlog.BinaryLogClient.connect(BinaryLogClient.java:564)
        at com.github.shyiko.mysql.binlog.BinaryLogClient$7.run(BinaryLogClient.java:796)
        at java.lang.Thread.run(Thread.java:748)
</code></pre><p>以及</p>
<pre><code>com.github.shyiko.mysql.binlog.network.ServerException: A slave with the same server_uuid/server_id as this slave has connected to the master; the first event &#39;mysql-bin.000001&#39; at 760357, the last event read from &#39;./mysql-bin.000001&#39; at 1888540, the last byte read from &#39;./mysql-bin.000001&#39; at 1888540.
        at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets(BinaryLogClient.java:885)
        at com.github.shyiko.mysql.binlog.BinaryLogClient.connect(BinaryLogClient.java:564)
        at com.github.shyiko.mysql.binlog.BinaryLogClient$7.run(BinaryLogClient.java:796)
        at java.lang.Thread.run(Thread.java:748)
</code></pre><h4 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h4><ul>
<li><a href="http://maxwells-daemon.io/filtering/" target="_blank" rel="noopener">Maxwell’s Daemon Doc</a></li>
<li><a href="http://pdf.us/2018/08/24/1750.html" target="_blank" rel="noopener">轻风博客.MySQL Binlog解析工具Maxwell 1.17.1 的安装和使用</a></li>
<li><a href="http://seanlook.com/2018/01/13/maxwell-binlog/" target="_blank" rel="noopener">Sean.自建Binlog订阅服务 —— Maxwell</a></li>
<li><a href="https://www.hi-linux.com/posts/47176.html" target="_blank" rel="noopener">MySQL 5.7 基于 GTID 的主从复制实践</a></li>
</ul>
<p><img src="http://image.laijianfeng.org/20190116_014816.png" alt="关注_小旋锋_微信公众号"></p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 whirlys@163.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span>文章标题:</span>MySQL Binlog 解析工具 Maxwell 详解</p>
    <p><span>文章字数:</span><span class="post-count">6,599</span></p>
    <p><span>本文作者:</span><a href="javascript:void(0)" title="小旋锋">小旋锋</a></p>
    <p><span>发布时间:</span>2019-03-11, 00:21:07</p>
    <p><span>最后更新:</span>2019-03-12, 12:52:09</p>
    <span>原始链接:</span><a class="post-url" href="/2019/03/MySQL-Binlog-解析工具-Maxwell-详解/" title="MySQL Binlog 解析工具 Maxwell 详解">http://laijianfeng.org/2019/03/MySQL-Binlog-解析工具-Maxwell-详解/</a>
    <p>
        <span>版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>


    <div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
        id: 'MySQL Binlog 解析工具 Maxwell 详解', // 可选。默认为 location.href
        owner: 'whirlys',
        repo: 'whirlys.github.io',
        oauth: {
            client_id: 'f1bd5294d498cdda9693',
            client_secret: '959bbaf23dae12023b1b9ee3e63e882a099ca65a',
        },
        perPage : 3
    })
    gitment.render('comments')
</script>



    </div>
    <div class="copyright">
        <p class="footer-entry">© 2018-2019, 小旋锋. All rights reserved. 粤ICP备17087743号</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.png" class="alipay" title="扫码支持">
            <img src="/img/weixin.png" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>

</body>
<script src="//cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min.js"></script>

<script src="//cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.2/photoswipe-ui-default.min.js"></script>

<script src="/js/script.js"></script>
<script>
    var img_resize = 'photoSwipe';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#Java编程','#elasticsearch','#lucene','#java','#spark','#mysql','#Zookeeper','#设计模式','#博客','#分布式系统理论',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        

        // PhotoSwipe
        $('article').each(function(i){
            $(this).find('img').each(function(){
                if ($(this).closest('figure').hasClass('article-gallery-img')) {
                    return;
                }
                var alt = this.alt;
                $(this)
                    .wrap('<figure class="article-gallery-img" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"></figure>')
                    .wrap('<a href="' + this.src + '" title="' + alt + '"></a>');
                $(this).after('<div class="img_alt"><span>' + (alt || '') + '</span></div>');
            });
        });

        var pswpElement = document.querySelectorAll('.pswp')[0];
        if (pswpElement) {
            var gallerySelector = '.article-gallery, article';

            var initPhotoSwipeFromDOM = function(gallerySelector) {

                // parse slide data (url, title, size ...) from DOM elements
                // (children of gallerySelector)
                var parseThumbnailElements = function(el) {
                    var thumbElements = $(el).find('figure.article-gallery-img').toArray(),
                        numNodes = thumbElements.length,
                        items = [],
                        figureEl,
                        linkEl,
                        size,
                        imgEl,
                        item;

                    for (var i = 0; i < numNodes; i++) {

                        figureEl = thumbElements[i]; // <figure> element

                        // include only element nodes
                        if (figureEl.nodeType !== 1) {
                            continue;
                        }

                        linkEl = figureEl.children[0]; // <a> element
                        imgEl = linkEl.children[0]; // <img>

                        size = linkEl.getAttribute('data-size');
                        size = size && size.split('x');

                        // create slide object
                        item = {
                            src: linkEl.getAttribute('href'),
                            w: size && parseInt(size[0], 10) || imgEl.width,
                            h: size && parseInt(size[1], 10) || imgEl.height
                        };

                        if (figureEl.children.length > 1) {
                            // <figcaption> content
                            item.title = figureEl.children[1].innerHTML;
                        }

                        if (linkEl.children.length > 0) {
                            // <img> thumbnail element, retrieving thumbnail url
                            item.msrc = linkEl.children[0].getAttribute('src');
                        }

                        item.el = figureEl; // save link to element for getThumbBoundsFn
                        items.push(item);
                    }

                    return items;
                };

                // find nearest parent element
                var closest = function closest(el, fn) {
                    return el && (fn(el) ? el : closest(el.parentNode, fn));
                };

                // triggers when user clicks on thumbnail
                var onThumbnailsClick = function(e) {
                    e = e || window.event;

                    var eTarget = e.target || e.srcElement;

                    // find root element of slide
                    var clickedListItem = closest(eTarget, function(el) {
                        return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
                    });

                    if (!clickedListItem) {
                        return;
                    }

                    if (e.preventDefault) {
                        e.preventDefault();
                    } else {
                        e.returnValue = false;
                    }

                    // find index of clicked item by looping through all child nodes
                    // alternatively, you may define index via data- attribute
                    var clickedGallery = $(clickedListItem).closest(gallerySelector)[0],
                        childNodes = $(clickedGallery).find('figure.article-gallery-img').toArray(),
                        numChildNodes = childNodes.length,
                        nodeIndex = 0,
                        index;

                    for (var i = 0; i < numChildNodes; i++) {
                        if (childNodes[i].nodeType !== 1) {
                            continue;
                        }

                        if (childNodes[i] === clickedListItem) {
                            index = nodeIndex;
                            break;
                        }
                        nodeIndex++;
                    }



                    if (index >= 0) {
                        // open PhotoSwipe if valid index found
                        openPhotoSwipe(index, clickedGallery);
                    }
                    return false;
                };

                // parse picture index and gallery index from URL (#&pid=1&gid=2)
                var photoswipeParseHash = function() {
                    var hash = window.location.hash.substring(1),
                        params = {};

                    if (hash.length < 5) {
                        return params;
                    }

                    var vars = hash.split('&');
                    for (var i = 0; i < vars.length; i++) {
                        if (!vars[i]) {
                            continue;
                        }
                        var pair = vars[i].split('=');
                        if (pair.length < 2) {
                            continue;
                        }
                        params[pair[0]] = pair[1];
                    }

                    if (params.gid) {
                        params.gid = parseInt(params.gid, 10);
                    }

                    return params;
                };

                var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
                    var pswpElement = document.querySelectorAll('.pswp')[0],
                        gallery,
                        options,
                        items;

                    items = parseThumbnailElements(galleryElement);

                    // define options (if needed)
                    options = {

                        // define gallery index (for URL)
                        galleryUID: galleryElement.getAttribute('data-pswp-uid'),

                        getThumbBoundsFn: function(index) {
                            // See Options -> getThumbBoundsFn section of documentation for more info
                            var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
                                pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
                                rect = thumbnail.getBoundingClientRect();

                            return {
                                x: rect.left,
                                y: rect.top + pageYScroll,
                                w: rect.width
                            };
                        }
                    };

                    // PhotoSwipe opened from URL
                    if (fromURL) {
                        if (options.galleryPIDs) {
                            // parse real index when custom PIDs are used
                            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                            for (var j = 0; j < items.length; j++) {
                                if (items[j].pid == index) {
                                    options.index = j;
                                    break;
                                }
                            }
                        } else {
                            // in URL indexes start from 1
                            options.index = parseInt(index, 10) - 1;
                        }
                    } else {
                        options.index = parseInt(index, 10);
                    }

                    // exit if index not found
                    if (isNaN(options.index)) {
                        return;
                    }

                    if (disableAnimation) {
                        options.showAnimationDuration = 0;
                    }

                    // Pass data to PhotoSwipe and initialize it
                    gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);

                    gallery.listen('imageLoadComplete', function(index, item) {
                        var linkEl = item.el.children[0];
                        var img = item.container.children[0];
                        if (!linkEl.getAttribute('data-size')) {
                            linkEl.setAttribute('data-size', img.naturalWidth + 'x' + img.naturalHeight);
                            item.w = img.naturalWidth;
                            item.h = img.naturalHeight;
                            gallery.invalidateCurrItems();
                            gallery.updateSize(true);
                        }
                    });

                    gallery.init();
                };

                // loop through all gallery elements and bind events
                var galleryElements = document.querySelectorAll(gallerySelector);

                for (var i = 0, l = galleryElements.length; i < l; i++) {
                    galleryElements[i].setAttribute('data-pswp-uid', i + 1);
                    galleryElements[i].onclick = onThumbnailsClick;
                }

                // Parse URL and open gallery if it contains #&pid=3&gid=1
                var hashData = photoswipeParseHash();
                if (hashData.pid && hashData.gid) {
                    openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
                }
            };

            // execute above function
            initPhotoSwipeFromDOM(gallerySelector);
        }
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /*引用块样式*/
    
    .post .pjax article blockquote {
        padding: 10px 20px;
        background-color: white;
        border: none;
        border-left: 4px solid #42b983;
        border-right: 4px solid #42b983;
        border-radius: 10px;
    }
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.1;
        background: url("http://image.laijianfeng.org/v2-cdcf5d00f2e9106f1fd0a70a18cbdf15_r1.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    
</style>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element, as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. PhotoSwipe keeps only 3 slides in DOM to save memory. -->
        <!-- don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>





</html>
